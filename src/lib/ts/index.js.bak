const fs = require('fs');


function scheduler(...subjects) {
  const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday']
  const startHour = 10
  const endHour = 18
  const hours = [...Array(endHour + 1 - startHour).keys()].map(
    (i) => i + startHour
  )
  
 
  const routine = {}
 
  for (let dayIndex = 0; dayIndex < days.length; dayIndex++) {
    const day = days[dayIndex]
    routine[day] = {}
    let hourIndex = 0
    console.log(subjects);
    const $subjects = shuffleArray(subjects.slice())
 
    for (
      let subjectIndex = 0;
      subjectIndex < $subjects.length;
      subjectIndex++
    ) {
      const subject = $subjects[subjectIndex]
      const nextSubject = $subjects[(subjectIndex + 1) % $subjects.length]
      let duration = 1
 
      // Alternate timing of subjects
      if (
        subjectIndex < $subjects.length - 1 &&
        nextSubject !== 'FREE' &&
        subject !== 'FREE'
      ) {
        const nextDayIndex = (dayIndex + 2) % days.length
        duration = nextDayIndex % 2 === 0 ? 2 : 1
      }
 
      for (let i = 0; i < duration; i++) {
        if (hourIndex >= hours.length) {
          break
        }
        const hour = hours[hourIndex]
        routine[day][`${hour}:00`] = subject.toUpperCase()
        hourIndex++
      }
 
      if (hourIndex >= hours.length) {
        break
      }
    }
 
    // fill remaining hours with 'FREE'
    while (hourIndex < hours.length) {
      const hour = hours[hourIndex]
      routine[day][`${hour}:00`] = 'FREE'
      hourIndex++
    }
  }
 
  // So i can hit the API and get a stringified JSON
  fs.writeFile("schedule.json", JSON.stringify(routine) ,err =>{
    if (err) throw(err);
  })
  return JSON.stringify(routine);
}
 
// just randomly shuffle classes for each day
function shuffleArray(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1))
    ;[array[i], array[j]] = [array[j], array[i]]
  }
  console.log(array);
  return array
}
 
const subjects = ['pr', 'dbms', 'rm', 'cn', 'ip', 'ddbms', 'nm', 'hr']
const teachers = ['MI', 'SNC', 'PG', 'A.K.K', 'LT', 'SD', 'DB', 'JHUMA']
console.log(scheduler(...subjects))